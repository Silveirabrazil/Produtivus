<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>üß™ Teste Produtivus - Login e Aulas</title>
    <link rel="stylesheet" href="css/app.css?v=2" />
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .log { margin: 5px 0; padding: 8px; background: #f8f9fa; border-radius: 4px; font-size: 14px; }
        .error { background: #ffe6e6; color: #d00; }
        .success { background: #e6ffe6; color: #0a0; }
        .info { background: #e6f3ff; color: #06c; }
        .warning { background: #fff3cd; color: #856404; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        .lesson-form { display: none; background: #f8f9fa; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        input[type="checkbox"] { width: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Produtivus - Sistema de Aulas</h1>

        <div class="test-section">
            <h2>üîê 1. Autentica√ß√£o</h2>
            <p>Primeiro, vamos simular o login do usu√°rio:</p>
            <button class="btn-primary" onclick="simulateLogin()">üöÄ Simular Login</button>
            <button class="btn-warning" onclick="clearAuth()">üóëÔ∏è Limpar Autentica√ß√£o</button>
            <button class="btn-danger" onclick="testProdAuth()">üîç Testar Auth Produ√ß√£o</button>
            <div id="auth-status" class="log info">Status: N√£o autenticado</div>
        </div>

        <div class="test-section">
            <h2>üìö 2. Teste de Cria√ß√£o de Aula</h2>
            <button class="btn-success" onclick="showLessonForm()">‚ûï Mostrar Formul√°rio</button>
            <button class="btn-primary" onclick="testLessonCreation()">üéØ Teste R√°pido</button>

            <div id="lesson-form" class="lesson-form">
                <h3>Criar Nova Aula</h3>
                <div class="form-group">
                    <label>T√≠tulo da Aula:</label>
                    <input type="text" id="lesson-title" value="Matem√°tica - √Ålgebra Linear" />
                </div>
                <div class="form-group">
                    <label>Cor:</label>
                    <input type="color" id="lesson-color" value="#E0B33A" />
                </div>
                <div class="form-group">
                    <label>Curso:</label>
                    <select id="lesson-course">
                        <option value="1">Curso de Matem√°tica</option>
                        <option value="2">Curso de F√≠sica</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Mat√©ria:</label>
                    <select id="lesson-subject">
                        <option value="1">Matem√°tica</option>
                        <option value="2">F√≠sica</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Dura√ß√£o (minutos):</label>
                    <input type="number" id="lesson-duration" value="90" />
                </div>
                <div class="form-group">
                    <label>Data de In√≠cio:</label>
                    <input type="date" id="lesson-start-date" value="2025-09-30" />
                </div>
                <div class="form-group">
                    <label>Data de T√©rmino:</label>
                    <input type="date" id="lesson-end-date" value="2025-12-15" />
                </div>
                <div class="form-group">
                    <label>Hora de In√≠cio:</label>
                    <input type="time" id="lesson-time" value="14:00" />
                </div>
                <div class="form-group">
                    <label>Hora de T√©rmino:</label>
                    <input type="time" id="lesson-end-time" value="15:30" />
                </div>
                <div class="form-group">
                    <label>Dias da Semana:</label>
                    <label><input type="checkbox" data-dow="1" checked> Segunda</label>
                    <label><input type="checkbox" data-dow="3" checked> Quarta</label>
                    <label><input type="checkbox" data-dow="5" checked> Sexta</label>
                </div>
                <button class="btn-success" onclick="submitLessonForm()">üíæ Criar Aula</button>
                <button class="btn-warning" onclick="hideLessonForm()">‚ùå Cancelar</button>
            </div>
        </div>

        <div class="test-section">
            <h2>üìã 3. Logs de Debug</h2>
            <button class="btn-warning" onclick="clearLogs()">üóëÔ∏è Limpar Logs</button>
            <div id="logs"></div>
        </div>
    </div>

    <script src="js/modules/tasks/tasks-test.js?v=202509280530"></script>
    <script>
        let logCount = 0;

        function addLog(message, type = 'log') {
            logCount++;
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>#${logCount}</strong> [${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('logs').appendChild(div);
            document.getElementById('logs').scrollTop = document.getElementById('logs').scrollHeight;
            console.log(`[TEST] ${message}`);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            logCount = 0;
        }

        function simulateLogin() {
            addLog('üîê Simulando login do usu√°rio...', 'info');

            const userData = {
                id: 1,
                email: 'usuario@teste.com',
                name: 'Usu√°rio Teste',
                authenticated: true,
                login_time: new Date().toISOString()
            };

            localStorage.setItem('pv_user', JSON.stringify(userData));
            addLog('‚úÖ Login simulado com sucesso! Usu√°rio: ' + userData.email, 'success');
            updateAuthStatus();
        }

        function clearAuth() {
            localStorage.removeItem('pv_user');
            addLog('üóëÔ∏è Autentica√ß√£o removida', 'warning');
            updateAuthStatus();
        }

        function updateAuthStatus() {
            const user = localStorage.getItem('pv_user');
            const statusEl = document.getElementById('auth-status');

            if (user) {
                const userData = JSON.parse(user);
                statusEl.innerHTML = `Status: ‚úÖ Logado como ${userData.email}`;
                statusEl.className = 'log success';
            } else {
                statusEl.innerHTML = 'Status: ‚ùå N√£o autenticado';
                statusEl.className = 'log error';
            }
        }

        async function testProdAuth() {
            addLog('üîç Testando autentica√ß√£o na produ√ß√£o...', 'info');

            try {
                const response = await fetch('https://cesarbrasilfotografia.com.br/server/api/account.php', {
                    method: 'GET',
                    credentials: 'include'
                });

                addLog(`Resposta da produ√ß√£o: Status ${response.status}`, response.ok ? 'success' : 'error');

                if (response.ok) {
                    const data = await response.json();
                    addLog(`Dados: ${JSON.stringify(data)}`, 'info');
                } else {
                    addLog(`Erro: ${response.statusText}`, 'error');
                }

            } catch (error) {
                addLog(`Exce√ß√£o: ${error.message}`, 'error');
            }
        }

        function showLessonForm() {
            document.getElementById('lesson-form').style.display = 'block';
            addLog('üìù Formul√°rio de aula exibido', 'info');
        }

        function hideLessonForm() {
            document.getElementById('lesson-form').style.display = 'none';
            addLog('‚ùå Formul√°rio de aula ocultado', 'info');
        }

        async function submitLessonForm() {
            const form = document.getElementById('lesson-form');
            addLog('üìù Submetendo formul√°rio de aula...', 'info');

            if (typeof window.onLessonFormSubmit === 'function') {
                const result = await window.onLessonFormSubmit(form);
                if (result) {
                    addLog('üéâ Aula criada com sucesso!', 'success');
                    hideLessonForm();
                } else {
                    addLog('‚ùå Erro ao criar aula', 'error');
                }
            } else {
                addLog('‚ùå Fun√ß√£o onLessonFormSubmit n√£o encontrada', 'error');
            }
        }

        async function testLessonCreation() {
            addLog('üéØ Iniciando teste r√°pido de cria√ß√£o de aula...', 'info');

            // Verificar autentica√ß√£o primeiro
            const user = localStorage.getItem('pv_user');
            if (!user) {
                addLog('‚ö†Ô∏è Usu√°rio n√£o autenticado. Simulando login...', 'warning');
                simulateLogin();
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            // Criar form tempor√°rio
            const form = document.createElement('form');
            form.innerHTML = `
                <input id="lesson-title" value="Teste - Aula R√°pida">
                <input id="lesson-color" value="#E0B33A">
                <select id="lesson-course"><option value="1" selected>Curso Teste</option></select>
                <select id="lesson-subject"><option value="1" selected>Mat√©ria Teste</option></select>
                <input id="lesson-duration" value="60">
                <input id="lesson-start-date" value="2025-09-30">
                <input id="lesson-end-date" value="2025-10-30">
                <input id="lesson-time" value="10:00">
                <input id="lesson-end-time" value="11:00">
                <input type="checkbox" data-dow="2" checked>
                <input type="checkbox" data-dow="4" checked>
            `;

            document.body.appendChild(form);

            try {
                if (typeof window.onLessonFormSubmit === 'function') {
                    const result = await window.onLessonFormSubmit(form);
                    if (result) {
                        addLog('‚úÖ Teste r√°pido: Aula criada com sucesso!', 'success');
                    } else {
                        addLog('‚ùå Teste r√°pido: Falha na cria√ß√£o', 'error');
                    }
                } else {
                    addLog('‚ùå Fun√ß√£o onLessonFormSubmit n√£o dispon√≠vel', 'error');
                }
            } finally {
                document.body.removeChild(form);
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            addLog('üöÄ Sistema de teste carregado', 'info');
            updateAuthStatus();

            // Verificar se scripts carregaram
            setTimeout(() => {
                const functions = ['onLessonFormSubmit', 'addOrEditTask', 'getTasks'];
                functions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        addLog(`‚úÖ ${funcName} dispon√≠vel`, 'success');
                    } else {
                        addLog(`‚ùå ${funcName} n√£o encontrada`, 'error');
                    }
                });
            }, 1000);
        });

        // Interceptar logs espec√≠ficos
        const originalLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('[AULA]') || message.includes('[API]') || message.includes('[DEBUG]') || message.includes('[TEST]')) {
                if (message.includes('‚ùå') || message.includes('ERRO')) {
                    addLog(message, 'error');
                } else if (message.includes('‚úÖ') || message.includes('SUCESSO')) {
                    addLog(message, 'success');
                } else if (message.includes('‚ö†Ô∏è') || message.includes('WARNING')) {
                    addLog(message, 'warning');
                } else {
                    addLog(message, 'info');
                }
            }
            originalLog.apply(console, args);
        };

        const originalError = console.error;
        console.error = function(...args) {
            const message = args.join(' ');
            if (message.includes('[AULA]') || message.includes('[API]') || message.includes('[DEBUG]')) {
                addLog(message, 'error');
            }
            originalError.apply(console, args);
        };
    </script>
</body>
</html>
