<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Produtivus — Planilhas</title>
  <meta name="app-version" content="20250916T2018">
  <meta name="description" content="Crie e edite planilhas online semelhantes ao Google Sheets.">
  <link rel="stylesheet" href="../css/app.css?v=2">
  <link rel="stylesheet" href="../apps/sheets/dist/assets/vendor-handsontable.css?v=20250916T2018">
  <link rel="stylesheet" href="../apps/sheets/dist/assets/index.css?v=20250916T2018">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
  <link rel="icon" href="../img/icone.png" type="image/png">
  <link rel="apple-touch-icon" href="../img/icone.png">
</head>

<body class="page-animate">
  <div id="header-container" class="container-fluid p-0"></div>

  <main id="main-content" class="app-main">
    <header class="page-header page-header--band cabecalho-page">
      <h1 class="page-header__title">
        Planilhas
        <span class="page-header__icon" aria-hidden="true">
          <span class="material-symbols-outlined">table_chart</span>
        </span>
      </h1>
      <p class="page-header__subtitle m-0">Crie e edite planilhas online semelhantes ao Google Sheets.</p>
    </header>
      <section class="page-section">
        <div id="sheets-vue-app"></div>
      </section>
  </main>

  <div id="footer-container" class="container-fluid mt-4"></div>

  <script src="../js/modules/header.js?v=20250923" defer></script>
  <script src="../js/modules/footer.js?v=20250923" defer></script>
  <script src="../js/modules/ui.js?v=20250916T2018" defer></script>
  <script src="../js/modules/error-handler.js?v=20250916T2018" defer></script>
  <script src="../js/modules/route-guard.js?v=20250916T2018" defer></script>
  <script src="../js/protect.js?v=20250916T2018" defer></script>
  <!-- bootstrap-shim removido -->
  <script src="../js/main.js?v=20250916T2018" defer></script>
  <script>
    (function(){
      const ver = (document.querySelector('meta[name="app-version"]')?.getAttribute('content')) || Date.now();
      const jsSrc = `../apps/sheets/dist/assets/index.js?v=${ver}`;
      if (!document.querySelector(`script[src^="../apps/sheets/dist/assets/index.js"]`)) {
        const script = document.createElement('script');
        script.type = 'module';
        script.src = jsSrc;
        document.head.appendChild(script);
      }
    })();
  </script>
  <!-- Backoff inteligente para POST /server/api/sheets.php -->
  <script>
  (function(){
    if(window.__pvSheetsBackoffApplied) return; window.__pvSheetsBackoffApplied = true;
    const origFetch = window.fetch; let failCount = 0; const MAX_FAIL=6;
    window.fetch = async function(url, opts){
      const isSheets = typeof url === 'string' && url.includes('/server/api/sheets.php');
      if(isSheets && failCount>0){
        const delay = Math.min(30000, 1500 * failCount * failCount); // backoff quadrático
        await new Promise(r=>setTimeout(r, delay));
      }
      try {
        const resp = await origFetch(url, opts);
        if(isSheets){
          if(resp.ok){ failCount = 0; }
          else { failCount = Math.min(MAX_FAIL, failCount+1); }
        }
        return resp;
      } catch(e){
        if(isSheets){
          failCount = Math.min(MAX_FAIL, failCount+1);
          if(failCount === MAX_FAIL){
            console.warn('[Sheets] Salvamento remoto temporariamente pausado após múltiplas falhas. Continuando local.');
          }
        }
        throw e;
      }
    };
  })();
  </script>
</body>

</html>
