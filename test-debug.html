<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>Teste Debug Aulas</title>
    <script src="js/modules/tasks/tasks-test.js?v=202509280525" defer></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 4px; }
        .error { background: #ffe6e6; color: #d00; }
        .success { background: #e6ffe6; color: #0a0; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üß™ Teste Debug Aulas</h1>
    <p>Abra o Console do Desenvolvedor (F12) para ver os logs detalhados.</p>

    <button onclick="testLessonCreation()">üéØ Testar Cria√ß√£o de Aula</button>
    <button onclick="testTaskCreation()">üìù Testar Cria√ß√£o de Tarefa</button>
    <button onclick="clearLogs()">üóëÔ∏è Limpar Logs</button>

    <div id="logs"></div>

    <script>
        let logCount = 0;

        function addLog(message, type = 'log') {
            logCount++;
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>#${logCount}</strong> ${message}`;
            document.getElementById('logs').appendChild(div);
            console.log(`[TEST] ${message}`);
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            logCount = 0;
        }

        function testLessonCreation() {
            addLog('üéØ Iniciando teste de cria√ß√£o de aula...');

            // Criar form mock para simular cria√ß√£o de aula
            const form = document.createElement('form');
            form.innerHTML = `
                <input id="lesson-title" value="Matem√°tica - √Ålgebra Linear">
                <input id="lesson-color" value="#E0B33A">
                <select id="lesson-course"><option value="1" selected>Curso de Matem√°tica</option></select>
                <select id="lesson-subject"><option value="2" selected>Matem√°tica</option></select>
                <input id="lesson-duration" value="90">
                <input id="lesson-start-date" value="2025-09-30">
                <input id="lesson-end-date" value="2025-12-15">
                <input id="lesson-time" value="14:00">
                <input id="lesson-end-time" value="15:30">
                <input type="checkbox" data-dow="1" checked>
                <input type="checkbox" data-dow="3" checked>
                <input type="checkbox" data-dow="5" checked>
            `;

            document.body.appendChild(form);

            addLog('üìù Form criado com dados de aula');

            // Verificar se fun√ß√£o existe
            if (typeof window.onLessonFormSubmit === 'function') {
                addLog('‚úÖ Fun√ß√£o onLessonFormSubmit encontrada');

                // Testar chamada
                window.onLessonFormSubmit(form).then(result => {
                    if (result) {
                        addLog('üéâ SUCESSO: Aula criada com sucesso!', 'success');
                    } else {
                        addLog('‚ùå ERRO: Falha na cria√ß√£o da aula', 'error');
                    }
                }).catch(error => {
                    addLog(`üí• EXCE√á√ÉO: ${error.message}`, 'error');
                });
            } else {
                addLog('‚ùå ERRO: Fun√ß√£o onLessonFormSubmit n√£o encontrada', 'error');
            }

            // Limpar form
            setTimeout(() => {
                document.body.removeChild(form);
            }, 1000);
        }

        function testTaskCreation() {
            addLog('üìù Iniciando teste de cria√ß√£o de tarefa...');

            const taskData = {
                title: 'Tarefa de Teste',
                description: 'Descri√ß√£o da tarefa',
                color: '#6A9BD1',
                start: '2025-09-30T10:00',
                end: '2025-09-30T11:00',
                subject_id: 1,
                is_private: false,
                reminder_minutes: 30,
                location: null,
                subtasks: []
            };

            if (typeof window.addOrEditTask === 'function') {
                addLog('‚úÖ Fun√ß√£o addOrEditTask encontrada');

                window.addOrEditTask(taskData).then(result => {
                    if (result) {
                        addLog('üéâ SUCESSO: Tarefa criada com sucesso!', 'success');
                    } else {
                        addLog('‚ùå ERRO: Falha na cria√ß√£o da tarefa', 'error');
                    }
                }).catch(error => {
                    addLog(`üí• EXCE√á√ÉO: ${error.message}`, 'error');
                });
            } else {
                addLog('‚ùå ERRO: Fun√ß√£o addOrEditTask n√£o encontrada', 'error');
            }
        }

        // Log inicial
        document.addEventListener('DOMContentLoaded', () => {
            addLog('üöÄ P√°gina carregada - iniciando testes...');

            setTimeout(() => {
                // Verificar se fun√ß√µes existem
                const functions = ['onLessonFormSubmit', 'addOrEditTask', 'getTasks'];
                functions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        addLog(`‚úÖ ${funcName} dispon√≠vel`);
                    } else {
                        addLog(`‚ùå ${funcName} n√£o encontrada`, 'error');
                    }
                });
            }, 1000);
        });

        // Interceptar logs do console
        const originalLog = console.log;
        console.log = function(...args) {
            if (args[0] && args[0].includes && (args[0].includes('[AULA]') || args[0].includes('[API]') || args[0].includes('[DEBUG]'))) {
                addLog(args.join(' '));
            }
            originalLog.apply(console, args);
        };

        const originalError = console.error;
        console.error = function(...args) {
            if (args[0] && args[0].includes && (args[0].includes('[AULA]') || args[0].includes('[API]') || args[0].includes('[DEBUG]'))) {
                addLog(args.join(' '), 'error');
            }
            originalError.apply(console, args);
        };
    </script>
</body>
</html>
